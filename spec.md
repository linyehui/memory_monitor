# 项目规格说明书：内存监控器 (Memory Monitor)

## 1. 概述
一个轻量级的命令行工具，用于实时监控系统或进程内存使用情况，并在增量超过阈值时发出警报。

## 2. 功能需求
- 实时监控 RAM 和 Swap 使用情况（系统模式）
- 实时监控进程的 RSS 和 VSZ（进程模式）
- 命令行第一个参数可以是一个进程ID，用于指定要监控的进程
- 命令行从运行开始持续在控制台中显示以下信息：
  * 命令行刚运行时的内存情况: RAM/Swap (系统模式) 或 RSS/VSZ (进程模式)
  * 当前时刻的内存情况: RAM/Swap 或 RSS/VSZ
  * 从命令行运行到当前的内存增量情况
- 命令行中的显示不要持续换行，而是在固定的行里面不断刷新
- 当 RAM/RSS 增量超过阈值 (50MB) 时，使用红色显示增量信息
- 监控工具本身应保持低资源占用
- 每 10 秒刷新一次数据

## 3. 技术栈
- **语言**: macOS 系统自带的 Bash Shell 脚本
- **依赖**: 仅使用系统内置命令 (vm_stat, sysctl, ps)
- **颜色**: ANSI 转义码实现终端颜色高亮

## 4. 架构
### 核心模块
1. **get_system_memory()**: 获取系统整体内存（RAM + Swap）
   - 使用 vm_stat 获取内存页信息
   - 使用 sysctl vm.swapusage 获取交换空间使用情况
   - 支持 M/G 单位自动转换

2. **get_process_memory()**: 获取指定进程内存（RSS + VSZ）
   - 使用 ps 命令获取进程内存信息
   - 检测进程是否存在

3. **format_duration()**: 格式化运行时长
   - 支持秒、分钟、小时、天的显示

4. **init()**: 初始化监控
   - 参数验证 (PID 必须为正整数)
   - 确定监控模式 (系统/进程)
   - 记录初始状态和时间
   - 绘制界面框架

5. **run()**: 主循环
   - 定时刷新内存数据
   - 计算增量并高亮显示
   - 固定位置更新显示内容


## 5. 使用场景
1. **开发调试**: 监控应用程序运行时的内存泄漏情况
2. **系统监控**: 观察系统整体内存压力和 Swap 使用趋势
3. **性能测试**: 记录长时间运行的内存变化情况

## 6. 已实现功能
- ✅ 基本 CLI 实时统计显示
- ✅ 系统内存监控 (RAM + Swap)
- ✅ 进程内存监控 (RSS + VSZ)
- ✅ 增量计算和红色警告
- ✅ 固定位置刷新显示
- ✅ PID 参数验证
- ✅ 时长格式化显示

## 7. 未来计划
1. 日志记录功能 (CSV/JSON 格式)
2. 支持命令行参数配置阈值和刷新间隔
3. 多进程并行监控
4. 图形化趋势显示
